<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>

body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        background-color: rgb(184, 200, 252);        
    }

    #divTabla {
        border: 2px solid black;
        padding: 20px;
        text-align: center;
        background-color: rgb(135, 173, 207);
    }

    #divTabla h1 {
        margin-top: 0;
    }

    #lblfiltro {
        font-weight: bold;
    }

    #divTabla label {
        display: inline-block;
        margin: 5px;
        vertical-align: middle;
    }

    #divTabla input[type="checkbox"] {
        margin: 0 5px;
        vertical-align: middle;
    }

    #tablaEntera {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
    }

    #tablaEntera th,
    #tablaEntera td {
        padding: 8px;
        border: 1px solid #080808;
    }

    #headers
    {
        background-color: brown;
        font-style: bold;
        color:blanchedalmond
    }

    #tablaDePersonas
    {
        background-color: rgb(210, 210, 210);
    }

    .Modificar,
    .Eliminar,
    .boton {
        padding: 8px;
        background-color: #4696bb;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    #btnAgregar
    {
        margin: 15px;
    }

    .Modificar:hover,
    .Eliminar:hover,
    .boton:hover {
        background-color: #216d85;
    }

    #divABM {
        border: 2px solid black;
        padding: 20px;
        text-align: center;
        background-color: rgb(243, 164, 137);
        margin-top: 20px;
        display: none;
    }

    .divABMInput {
        padding: 5px;
    }

    #divABM h1 {
        margin-top: 0;
    }

    #divABM label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
    }

    #divABM input[type="text"],
    #divABM select {
        width: 200px;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    #divABM button {
        padding: 8px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 20px;
    }

    @media (max-width: 768px) {
        #divTabla {
            padding: 10px;
        }

        #divTabla input[type="checkbox"] {
            display: block;
            margin: 5px auto;
        }

        #tablaEntera {
            font-size: 12px;
        }
    }
    
    .oculta 
    {
        display: none;
    }   

    #overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5); 
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999; 
    }

    .spinner {
        width: 50px;
        height: 50px;
        background-image: url(

        'https://icon-library.com/images/loading-icon-transparent-background/loading-icon-transparent-background-18.jpg' 

        );
        background-size: cover;
        animation: spin 1s infinite linear;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    </style>
    <title>Segundo Parcial Tobias Moretti</title>
</head>

<body>

    <div id="divTabla" style="border: 2px solid black; display: inline-block; padding: 5px;">
        <h1>Personas Futbolistas Profecionales</h1>
        <label for="filtro"id="lblfiltro">Filtrar Por:</label>
        <select id="filtro" name="filtro">
            <option value="Todos">Todos</option>
            <option value="Futbolista">Futbolista</option>
            <option value="Profecional">Profecional</option>
        </select>
        <label>Mostrar Columnas:</label>  
        <br>
        <input type="checkbox" id="ID" class="chkbx" name="ID" checked>
        <label for="ID">ID</label>
        <input type="checkbox" id="Nombre" class="chkbx" name="Nombre" checked>
        <label for="Nombre">Nombre</label>
        <input type="checkbox" id="Apellido" class="chkbx" name="Apellido" checked>
        <label for="Apellido">Apellido</label>
        <input type="checkbox" id="Edad" class="chkbx" name="Edad" checked>
        <label for="Edad">Edad</label>
        <input type="checkbox" id="Equipo" class="chkbx" name="Equipo" checked>
        <label for="Equipo">Equipo</label>
        <input type="checkbox" id="Posicion" class="chkbx" name="Posicion" checked>
        <label for="Posicion">Posicion</label>
        <input type="checkbox" id="CantidadGoles" class="chkbx" name="CantidadGoles" checked>
        <label for="CantidadGoles">Cantidad de Goles</label>
        <input type="checkbox" id="Titulo" class="chkbx" name="Titulo" checked>
        <label for="Titulo">Titulo</label>
        <input type="checkbox" id="Facultad" class="chkbx" name="Facultad" checked>
        <label for="Facultad">Facultad</label>
        <input type="checkbox" id="AñoGraduacion" class="chkbx" name="AñoGraduacion" checked>
        <label for="AñoGraduacion">Año de Graducion</label>  
        <br>
        <table id="tablaEntera">
            <thead id="headers">
                <tr>
                    <th class="tablaHeader columnaID">ID</th>
                    <th class="tablaHeader columnaNombre">Nombre</th>
                    <th class="tablaHeader columnaApellido">Apellido</th>
                    <th class="tablaHeader columnaEdad">Edad</th>
                    <th class="tablaHeader columnaEquipo">Equipo</th>
                    <th class="tablaHeader columnaPosicion">Posicion</th>
                    <th class="tablaHeader columnaCantidadGoles">Cantidad Goles</th>
                    <th class="tablaHeader columnaTitulo">Titulo</th>
                    <th class="tablaHeader columnaFacultad">Facultad</th>
                    <th class="tablaHeader columnaAñoGraducion">Año Graduacion</th>
                    <th class="tablaHeader columnaBotonModificar">Modificar</th>
                    <th class="tablaHeader columnaBotonEliminar">Eliminar</th>
                </tr>
            </thead>
            <tbody id="tablaDePersonas">
            </tbody>
        </table>
        <div>
            <button class="boton" id="btnAgregar">Agregar Elemento</button>
        </div>        
    </div>

    <div id="divABM">
        <h1 id="CantidadGolesABM">Formulario ABM</h1>
    
        <div class="divABMInput">
            <label for="txtid" id="lblid">Id:</label>
            <input type="text" id="txtid" name="id" value="" disabled>
        </div>
        
        <div class="divABMInput">
            <label for="txtNombre" id="lblNombre">Nombre:</label>
            <input type="text" id="txtNombre" name="Nombre" value="">
        </div>
        
        <div class="divABMInput">
            <label for="txtApellido" id="lblApellido">Apellido:</label>
            <input type="text" id="txtApellido" name="Apellido" value="">
        </div>
        
        <div class="divABMInput">
            <label for="txtEdad" id="lblEdad">Edad</label>
            <input type="text" id="txtEdad" name="Edad" value="">
        </div>
        
        <div class="divABMInput">
            <label for="selectTipo" id="lbltipo">Tipo:</label>
            <select name="tipo" id="selectTipo" >
                <option value="Fultbolista" selected>Futbolista</option>
                <option value="Profecional">Profecional</option>
            </select>
        </div>
        
        <div class="divABMInput">
            <label for="txtAtr5" id="lblAtr5">:</label>
            <input type="text" id="txtAtr5" name="txtAtr5" value="">
        </div>
        
        <div class="divABMInput">
            <label for="txtAtr6" id="lblAtr6">:</label>
            <input type="text" id="txtAtr6" name="txtAtr6" value="">
        </div>

        <div class="divABMInput">
            <label for="txtAtr7" id="lblAtr7">:</label>
            <input type="text" id="txtAtr7" name="txtAtr7" value="">
        </div>
        
        <button class="boton" id="btnAceptar">Aceptar</button>
        <button class="boton" id="btnCancelar">Cancelar</button>
    </div>

    <div id="overlay">
        <div class="spinner"></div>
    </div>
    <script>

        class Persona {
            id;
            nombre;
            apellido;
            edad;

            constructor(id, nombre, apellido, edad) {
                this.id = id;
                this.nombre = nombre;
                this.apellido = apellido;
                this.edad = parseInt(edad);
            }

            toString() {
                return "ID: " + this.id +                  
                ", Nombre: " + this.nombre +                    
                ", Apellido: " + this.apellido +                    
                ", Edad: " + this.edad;
            }
        }

        class Futbolista extends Persona {
            equipo;
            posicion;
            cantidadGoles;

            constructor(id, nombre, apellido, edad, equipo, posicion, cantidadGoles) {
                super(id, nombre, apellido, edad);
                this.equipo = equipo;
                this.posicion = posicion;
                this.cantidadGoles = parseInt(cantidadGoles);
            }

            toString() {
                return super.toString(this.id, this.nombre, this.apellido, this.edad) +
                    ", Equipo: " + this.equipo +
                    ", Posicion: " + this.posicion +
                    ", Cantidad de Goles: " + this.cantidadGoles;
                    
            }
        }

        class Profecional extends Persona {
            titulo;
            facultad;
            añoGraduacion;

            constructor(id, nombre, apellido, edad, titulo, facultad, añoGraduacion) {
                super(id, nombre, apellido, edad);
                this.titulo = titulo;
                this.facultad = facultad;
                this.añoGraduacion = parseInt(añoGraduacion);
            }

            toString() {
                return super.toString(this.id, this.nombre, this.apellido, this.edad) +
                    ", Titulo: " + this.titulo +
                    ", Facultad: " + this.facultad +
                    ", Año de Graduacion: " + this.añoGraduacion;
            }
        }

        var divTabla = document.getElementById("divTabla");

        var filtro = document.getElementById("filtro");
        var elementosADibujar = document.getElementById("filtro").value;

        var chkid = document.getElementById("ID");
        var chknombre = document.getElementById("Nombre");
        var chkapellido = document.getElementById("Apellido");
        var chkedad = document.getElementById("Edad");
        var chkequipo = document.getElementById("Equipo");
        var chkposicion = document.getElementById("Posicion");
        var chkcantidadGoles = document.getElementById("CantidadGoles");        
        var chktitulo = document.getElementById("Titulo");
        var chkfacultad = document.getElementById("Facultad");  
        var chkañoGraduacion = document.getElementById("AñoGraduacion");          

        var tablaDePersonas = document.getElementById("tablaDePersonas");

        var filas = tablaDePersonas.querySelectorAll('tr');
        
        var btnAgregar = document.getElementById("btnAgregar");

        var divABM = document.getElementById("divABM");

        var txtNombre = document.getElementById("txtNombre").value;
        var txtApellido = document.getElementById("txtApellido").value;
        var txtEdad = document.getElementById("txtEdad").value;
        var selectTipo = document.getElementById("selectTipo");
        var txtAtr5 = document.getElementById("txtAtr5").value;
        var lblAtr5 = document.getElementById("lblAtr5");
        var txtAtr6 = document.getElementById("txtAtr6").value;
        var lblAtr6 = document.getElementById("lblAtr6");
        var txtAtr7 = document.getElementById("txtAtr7").value;
        var lblAtr7 = document.getElementById("lblAtr7");
        
        var btnAceptar = document.getElementById("btnAceptar");
        var btnCancelar = document.getElementById("btnCancelar");

        var spinner = document.getElementById("spinner");
        
        var mostrarTabla = true;

        var ordenAplicado = "idAsc";

        var database = null;
        var data = null;
        var persona = null;

        window.addEventListener('load', enviarGet);

        function enviarGet() {
            entraSpinner();

            fetch("personasFutbolitasProfesionales.php", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(response => {
                saleSpinner();

                if (response.status === 200) {
                    return response.json();
                } else {
                    console.log (response.status);
                    console.log("Falló la request HTTP");
                    throw new Error("Falló la request HTTP");
                }
            })
            .then(data => {
                database = data;
                personas = data.map(obj => {
                    if ('cantidadGoles' in obj) {
                        return new Futbolista(obj.id, obj.nombre, obj.apellido, obj.edad,obj.equipo,obj.posicion,obj.cantidadGoles);
                    } else {                     
                        return new Profecional(obj.id, obj.nombre, obj.apellido, obj.edad,obj.titulo,obj.facultad,obj.añoGraduacion);
                    }
                });
                dibujarTabla();
            })
            .catch(error => {
                alert("No se pudo generar el alta: " + error );
            });
        }

        function entraSpinner() {
        var overlay = document.getElementById("overlay");
        overlay.style.display = "flex";
        }

        function saleSpinner() {
        var overlay = document.getElementById("overlay");
        overlay.style.display = "none";
        }

        function levantarDatosFormulario()
        {
            txtid = document.getElementById("txtid").value;
            txtNombre = document.getElementById("txtNombre").value;
            txtApellido = document.getElementById("txtApellido").value;
            txtEdad = document.getElementById("txtEdad").value;
            selectTipo = document.getElementById("selectTipo");
            txtAtr5 = document.getElementById("txtAtr5").value;
            txtAtr6 = document.getElementById("txtAtr6").value;
            txtAtr7 = document.getElementById("txtAtr7").value;
        }

        function deshabilitarCampos()
        {
            document.getElementById("txtNombre").disabled = document.getElementById("CantidadGolesABM").innerText=="Baja";
            document.getElementById("txtApellido").disabled = document.getElementById("CantidadGolesABM").innerText=="Baja";
            document.getElementById("txtEdad").disabled = document.getElementById("CantidadGolesABM").innerText=="Baja";
            document.getElementById("txtAtr5").disabled = document.getElementById("CantidadGolesABM").innerText=="Baja";
            document.getElementById("txtAtr6").disabled = document.getElementById("CantidadGolesABM").innerText=="Baja";
            document.getElementById("txtAtr7").disabled = document.getElementById("CantidadGolesABM").innerText=="Baja";
        }

        function blanquearFormulario()
        {
            document.getElementById("txtid").value="";
            document.getElementById("txtNombre").value="";
            document.getElementById("txtApellido").value="";
            document.getElementById("txtEdad").value="";
            document.getElementById("txtAtr5").value="";
            document.getElementById("txtAtr6").value="";
            document.getElementById("txtAtr7").value="";
            
        }

        function alternarVista()
        {

            if (mostrarTabla)
            {
                actualizarLabels();
                deshabilitarCampos();
                mostrarTabla=false;
                divTabla.style.display="none";
                divABM.style.display="inline-block";
                document.getElementById("txtid").value="A/D";
            }else
            {
                mostrarTabla=true;
                divTabla.style.display="inline-block";
                divABM.style.display="none";
            }
            dibujarTabla();
            refrescarEventListener();
        }

        function dibujarTabla() 
        {
            filtro = document.getElementById("filtro");
            elementosADibujar = filtro.value;

            tablaDePersonas.innerHTML = "";
            
            
            personas.forEach((persona) => {

                
                var row;
                if(persona instanceof Profecional && (elementosADibujar == "Todos" || elementosADibujar == "Profecionales"))
                {
                    
                    row = tablaDePersonas.insertRow();

                    row.setAttribute("id", persona.id);


                    var idCell = row.insertCell();
                    idCell.textContent = persona.id;
                    idCell.classList.add("columnaID");                    

                    var nombreCell = row.insertCell();
                    nombreCell.textContent = persona.nombre;
                    nombreCell.classList.add("columnaNombre"); 

                    var apellidoCell = row.insertCell();
                    apellidoCell.textContent = persona.apellido;
                    apellidoCell.classList.add("columnaApellido"); 

                    var edadCell = row.insertCell();
                    edadCell.textContent = persona.edad;
                    edadCell.classList.add("columnaEdad"); 

                    var equipoCell = row.insertCell();
                    equipoCell.textContent = "N/A";
                    equipoCell.classList.add("columnaEquipo"); 

                    var posicionCell = row.insertCell();
                    posicionCell.textContent = "N/A";
                    posicionCell.classList.add("columnaPosicion"); 

                    var cantidadGolesCell = row.insertCell();
                    cantidadGolesCell.textContent = "N/A";
                    cantidadGolesCell.classList.add("columnaCantidadGoles"); 

                    var tituloCell = row.insertCell();
                    tituloCell.textContent = persona.titulo;
                    tituloCell.classList.add("columnaTitulo"); 

                    var facultadCell = row.insertCell();
                    facultadCell.textContent = persona.facultad;
                    facultadCell.classList.add("columnaFacultad"); 

                    var añoGraduacionCell = row.insertCell();
                    añoGraduacionCell.textContent = persona.añoGraduacion;
                    añoGraduacionCell.classList.add("columnaAñoGraduacion"); 

                    var modificarCell = row.insertCell();
                    var botonMod = document.createElement("button");
                    botonMod.innerText = "Modificar";
                    botonMod.className = "Modificar";
                    botonMod.id=persona.id;
                    modificarCell.appendChild(botonMod);

                    var eliminarCell = row.insertCell();
                    var botonDel = document.createElement("button");
                    botonDel.innerText = "Eliminar";
                    botonDel.className = "Eliminar";
                    botonDel.id=persona.id;
                    eliminarCell.appendChild(botonDel);

                }
                else if (persona instanceof Futbolista && (elementosADibujar == "Todos" || elementosADibujar == "Futbolistas"))
                {
                    row = tablaDePersonas.insertRow();
                    
                    row.setAttribute("id", persona.id);

                    var idCell = row.insertCell();
                    idCell.textContent = persona.id;
                    idCell.classList.add("columnaID"); 

                    var nombreCell = row.insertCell();
                    nombreCell.textContent = persona.nombre;
                    nombreCell.classList.add("columnaNombre"); 

                    var apellidoCell = row.insertCell();
                    apellidoCell.textContent = persona.apellido;
                    apellidoCell.classList.add("columnaApellido"); 

                    var edadCell = row.insertCell();
                    edadCell.textContent = persona.edad;
                    edadCell.classList.add("columnaEdad"); 

                    var equipoCell = row.insertCell();
                    equipoCell.textContent = persona.equipo;
                    equipoCell.classList.add("columnaEquipo"); 

                    var posicionCell = row.insertCell();
                    posicionCell.textContent = persona.posicion;
                    posicionCell.classList.add("columnaPosicion"); 

                    var cantidadGolesCell = row.insertCell();
                    cantidadGolesCell.textContent = persona.cantidadGoles;
                    cantidadGolesCell.classList.add("columnaCantidadGoles"); 

                    var tituloCell = row.insertCell();
                    tituloCell.textContent = "N/A";
                    tituloCell.classList.add("columnaTitulo"); 

                    var facultadCell = row.insertCell();
                    facultadCell.textContent = "N/A";
                    facultadCell.classList.add("columnaFacultad"); 

                    var añoGraduacionCell = row.insertCell();
                    añoGraduacionCell.textContent = "N/A";                 
                    añoGraduacionCell.classList.add("columnaAñoGraduacion"); 

                    var modificarCell = row.insertCell();
                    var botonMod = document.createElement("button");
                    botonMod.innerText = "Modificar";
                    botonMod.className = "Modificar";
                    botonMod.id=persona.id;
                    modificarCell.appendChild(botonMod);

                    var eliminarCell = row.insertCell();
                    var botonDel = document.createElement("button");
                    botonDel.innerText = "Eliminar";
                    botonDel.className = "Eliminar";
                    botonDel.id=persona.id;
                    eliminarCell.appendChild(botonDel);
                }

            });
            refrescarEventListener();
            actualizarColumnas();
            colorearFilas();
        }

        function colorearFilas()
        {
            contador=1;
            arrayFilas=document.querySelectorAll("tr");
            arrayFilas.forEach(fila => {
                if (contador%2==0)
                {
                    fila.style.backgroundColor = "#999999";
                }
                contador++;
            });            
        }

        function resetearCheckboxes()
        {
            var checkboxes = document.querySelectorAll('input[type="checkbox"]');

            for (var i = 0; i < checkboxes.length; i++) {
            checkboxes[i].checked = true;
            }
        }

        var checkboxes = document.querySelectorAll('.chkbx');

        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                actualizarColumnas();
            });
        });
       
        function mostrarOcultarColumna (nombre, ocultar)
        {
            var headers = document.getElementById("headers");
            var tablaDatos = document.getElementById("tablaDePersonas");

            var headerCell = headers.querySelector("th."+nombre);
            var cells = tablaDatos.querySelectorAll("td."+nombre);

            if(ocultar)
            {
                headerCell.classList.add("oculta");
                for (var i = 0; i < cells.length; i++) {
                cells[i].classList.add("oculta");
                }
            }       
            else
            {
                headerCell.classList.remove("oculta");
                for (var i = 0; i < cells.length; i++) {
                cells[i].classList.remove("oculta");
                }
            }     
        }

        function actualizarColumnas()
        {
            mostrarOcultarColumna("columnaID",!chkid.checked);

            mostrarOcultarColumna("columnaNombre",!chknombre.checked);

            mostrarOcultarColumna("columnaApellido",!chkapellido.checked);

            mostrarOcultarColumna("columnaEdad",!chkedad.checked);

            mostrarOcultarColumna("columnaEquipo",!chkequipo.checked);

            mostrarOcultarColumna("columnaPosicion",!chkposicion.checked);

            mostrarOcultarColumna("columnaCantidadGoles",!chkcantidadGoles.checked);

            mostrarOcultarColumna("columnaTitulo",!chktitulo.checked);

            mostrarOcultarColumna("columnaFacultad",!chkfacultad.checked);

            mostrarOcultarColumna("columnaAñoGraduacion",!chkañoGraduacion.checked);
        }

        function refrescarEventListener()
        {
            var botonesMod = document.querySelectorAll(".Modificar");
            botonesMod.forEach((botonMod)=>
            {
                botonMod.addEventListener('click', () =>
                {
                    modificacion(event.target.id);
                });
            });

            var botonesDel = document.querySelectorAll(".Eliminar");
            botonesDel.forEach((botonDel)=>
            {
                botonDel.addEventListener('click', () =>
                {
                    baja(event.target.id);
                });
            });
        }

        function alta()
        {
            document.getElementById("CantidadGolesABM").innerText="Alta";
            alternarVista();
            selectTipo.disabled=false;
        }

        function baja(id)
        {   
            actualizarLabels();
            document.getElementById("CantidadGolesABM").innerText="Baja";
            alternarVista();
            completarABM(id);
        }

        function modificacion(id)
        {
            actualizarLabels();
            document.getElementById("CantidadGolesABM").innerText="Modificación";
            alternarVista();
            completarABM(id);
        }

        function completarABM (idpersona)
        {
            var personaAEditar;
            actualizarLabels();
            selectTipo.disabled=true;
            personaAEditar = personas.reduce((personaAEditar, persona)=>
            {
                if(persona.id==idpersona)
                {
                    document.getElementById("txtid").value = persona.id;
                    document.getElementById("txtNombre").value = persona.Nombre;
                    document.getElementById("txtApellido").value = persona.Apellido;
                    document.getElementById("txtEdad").value = persona.Edad;
                    if (persona instanceof Futbolista)
                    {
                        selectTipo.value="Futbolista";

                        document.getElementById("txtAtr5").value= persona.Equipo;
                        document.getElementById("txtAtr6").value= persona.CantidadGoles;
                        document.getElementById("txtAtr7").value= persona.Posicion;
                        
                    }
                    else
                    {
                        selectTipo.value="Profecional";

                        document.getElementById("txtAtr5").value= persona.Titulo;
                        document.getElementById("txtAtr6").value= persona.Facultad;
                        document.getElementById("txtAtr7").value= persona.AñoGraduacion;
                    }
                }
            },null); 
            return personaAEditar;
        }

        var tablaHeaders = document.getElementsByClassName("tablaHeader");

        Array.from(tablaHeaders).forEach((header) => {
            header.addEventListener("click", () => {
        
                switch (event.target.textContent)
                {
                    case "ID":
                    {
                        if (ordenAplicado == "idAsc")
                        {
                            personas.sort(compararPorIdDesc);
                            ordenAplicado="idDesc";
                        }
                        else
                        {
                            personas.sort(compararPorId);
                            ordenAplicado="idAsc";
                        }
                        dibujarTabla();
                        break;
                    }                        
                    case "Nombre":
                    {
                        if (ordenAplicado == "NombreAsc")
                        {
                            personas.sort(compararPorNombreDesc);
                            ordenAplicado="NombreDesc";
                        }
                        else
                        {
                            personas.sort(compararPorNombre);
                            ordenAplicado="NombreAsc";
                        }
                        dibujarTabla();
                        break;
                    }                        
                    case "Apellido":
                    {
                        if (ordenAplicado == "ApellidoAsc")
                        {
                            personas.sort(compararPorApellidoDesc);
                            ordenAplicado="ApellidoDesc";
                        }
                        else
                        {
                            personas.sort(compararPorApellido);
                            ordenAplicado="ApellidoAsc";
                        }
                        dibujarTabla();
                        break;
                    }
                    case "Edad":
                    {
                        if (ordenAplicado == "EdadAsc")
                        {
                            personas.sort(compararPorEdadDesc);
                            ordenAplicado="EdadDesc";
                        }
                        else
                        {
                            personas.sort(compararPorEdad);
                            ordenAplicado="EdadAsc";
                        }
                        dibujarTabla();
                        break;
                    }                     
                    case "Equipo":
                    {
                        if (ordenAplicado == "EquipoAsc")
                        {
                            personas.sort(compararPorEquipoDesc);
                            ordenAplicado="EquipoDesc";
                        }
                        else
                        {
                            personas.sort(compararPorEquipo);
                            ordenAplicado="EquipoAsc";
                        }
                        dibujarTabla();
                        break;
                    }                    
                    case "Posicion":
                    {
                        if (ordenAplicado == "PosicionAsc")
                        {
                            personas.sort(compararPorPosicionDesc);
                            ordenAplicado="PosicionDesc";
                        }
                        else
                        {
                            personas.sort(compararPorPosicion);
                            ordenAplicado="PosicionAsc";
                        }
                        dibujarTabla();
                        break;
                    }                    
                    case "CantidadGoles":
                    {
                        if (ordenAplicado == "CantidadGolesAsc")
                        {
                            personas.sort(compararPorCantidadGolesDesc);
                            ordenAplicado="CantidadGolesDesc";
                        }
                        else
                        {
                            personas.sort(compararPorCantidadGoles);
                            ordenAplicado="CantidadGolesAsc";
                        }
                        dibujarTabla();
                        break;
                    }                    
                    case "Titulo":
                    {
                        if (ordenAplicado == "TituloAsc")
                        {
                            personas.sort(compararPorTituloDesc);
                            ordenAplicado="TituloDesc";
                        }
                        else
                        {
                            personas.sort(compararPorTitulo);
                            ordenAplicado="TituloAsc";
                        }
                        dibujarTabla();
                        break;
                    }
                    case "Facultad":
                    {
                        if (ordenAplicado == "FacultadAsc")
                        {
                            personas.sort(compararPorFacultadDesc);
                            ordenAplicado="FacultadDesc";
                        }
                        else
                        {
                            personas.sort(compararPorFacultad);
                            ordenAplicado="FacultadAsc";
                        }
                        dibujarTabla();
                        break;
                    } 
                    case "AñoGraduacion":
                    {
                        if (ordenAplicado == "AñoGraduacionAsc")
                        {
                            personas.sort(compararPorAñoGraduacionDesc);
                            ordenAplicado="AñoGraduacionDesc";
                        }
                        else
                        {
                            personas.sort(compararPorAñoGraduacion);
                            ordenAplicado="AñoGraduacionAsc";
                        }
                        dibujarTabla();
                        break;
                    }                         
                    default:{}
                }
            });
        });

        function compararPorId(a, b) {
        return a.id - b.id;
        }

        function compararPorNombre(a, b) {
        return a.Nombre.localeCompare(b.Nombre);
        }

        function compararPorApellido(a, b) {
        return a.Apellido.localeCompare(b.Apellido);
        }

        function compararPorEdad(a, b) {
        return a.Edad - b.Edad;
        }

        function compararPorEquipo(a, b) 
        {
            if(a instanceof Futbolista && b instanceof Futbolista)
            {
                ret = 0;
            }
            else if (a instanceof Futbolista)
            {
                ret = 1
            }
            else if (b instanceof Futbolista)
            {
                ret = -1;
            }
            else
            {
                ret = a.Equipo.localeCompare(b.Equipo);
            }            
            return ret;
        }

        function compararPorPosicion(a, b) 
        {
            if(a instanceof Futbolista && b instanceof Futbolista)
            {
                ret = 0;
            }
            else if (a instanceof Futbolista)
            {
                ret = 1
            }
            else if (b instanceof Futbolista)
            {
                ret = -1;
            }
            else
            {
                ret = a.Posicion-b.Posicion;
            }  
            return ret;          
        }

        function compararPorCantidadGoles(a, b) 
        {
            if(a instanceof Futbolista && b instanceof Futbolista)
            {
                ret = 0;
            }
            else if (a instanceof Futbolista)
            {
                ret = 1
            }
            else if (b instanceof Futbolista)
            {
                ret = -1;
            }
            else
            {
                ret = a.CantidadGoles.localeCompare(b.CantidadGoles);
            }   
            return ret; 
        }

        function compararPorTitulo(a, b) 
        {
            if(a instanceof Profecional && b instanceof Profecional)
            {
                ret = 0;
            }
            else if (a instanceof Profecional)
            {
                ret = 1
            }
            else if (b instanceof Profecional)
            {
                ret = -1;
            }
            else
            {
                ret = a.Titulo.localeCompare(b.Titulo);
            } 
            return ret;
        }

        function compararPorFacultad(a, b) 
        {
            if(a instanceof Profecional && b instanceof Profecional)
            {
                ret = 0;
            }
            else if (a instanceof Profecional)
            {
                ret = 1
            }
            else if (b instanceof Profecional)
            {
                ret = -1;
            }
            else
            {
                ret = a.Facultad.localeCompare(b.Facultad);
            } 
            return ret;
        }

        function compararPorAñoGraduacion(a, b) 
        {
            if(a instanceof Profecional && b instanceof Profecional)
            {
                ret = 0;
            }
            else if (a instanceof Profecional)
            {
                ret = 1
            }
            else if (b instanceof Profecional)
            {
                ret = -1;
            }
            else
            {
                ret = a.AñoGraduacion.localeCompare(b.AñoGraduacion);
            } 
            return ret;
        }

        function compararPorIdDesc(b, a) {
        return a.id - b.id;
        }

        function compararPorNombreDesc(b, a) {
        return a.Nombre.localeCompare(b.Nombre);
        }

        function compararPorApellidoDesc(b, a){
        return a.Apellido.localeCompare(b.Apellido);
        }

        function compararPorEdadDesc(b, a){
        return a.Edad - b.Edad;
        }

        function compararPorEquipoDesc(b, a)
        {
            if(a instanceof Futbolista && b instanceof Futbolista)
            {
                ret = 0;
            }
            else if (a instanceof Futbolista)
            {
                ret = -1
            }
            else if (b instanceof Futbolista)
            {
                ret = 1;
            }
            else
            {
                ret = a.Equipo.localeCompare(b.Equipo);
            }            
            return ret;
        }

        function compararPorPosicionDesc(b, a)
        {
            if(a instanceof Futbolista && b instanceof Futbolista)
            {
                ret = 0;
            }
            else if (a instanceof Futbolista)
            {
                ret = -1
            }
            else if (b instanceof Futbolista)
            {
                ret = 1;
            }
            else
            {
                ret = a.Posicion-b.Posicion;
            }  
            return ret;          
        }

        function compararPorCantidadGolesDesc(b, a)
        {
            if(a instanceof Futbolista && b instanceof Futbolista)
            {
                ret = 0;
            }
            else if (a instanceof Futbolista)
            {
                ret = -1
            }
            else if (b instanceof Futbolista)
            {
                ret = 1;
            }
            else
            {
                ret = a.CantidadGoles.localeCompare(b.CantidadGoles);
            }   
            return ret; 
        }

        function compararPorTituloDesc(b, a)
        {
            if(a instanceof Profecional && b instanceof Profecional)
            {
                ret = 0;
            }
            else if (a instanceof Profecional)
            {
                ret = -1
            }
            else if (b instanceof Profecional)
            {
                ret = 1;
            }
            else
            {
                ret = a.Titulo.localeCompare(b.Titulo);
            } 
            return ret;
        }

        
        function compararPorFacultadDesc(b, a)
        {
            if(a instanceof Profecional && b instanceof Profecional)
            {
                ret = 0;
            }
            else if (a instanceof Profecional)
            {
                ret = -1
            }
            else if (b instanceof Profecional)
            {
                ret = 1;
            }
            else
            {
                ret = a.Facultad.localeCompare(b.Facultad);
            } 
            return ret;
        }

        
        function compararPorAñoGraduacionDesc(b, a)
        {
            if(a instanceof Profecional && b instanceof Profecional)
            {
                ret = 0;
            }
            else if (a instanceof Profecional)
            {
                ret = -1
            }
            else if (b instanceof Profecional)
            {
                ret = 1;
            }
            else
            {
                ret = a.AñoGraduacion.localeCompare(b.AñoGraduacion);
            } 
            return ret;
        }

        function actualizarLabels()
        {
            
            if (selectTipo.value=="Profecional")
            {
                lblAtr5.textContent="Titulo";
                lblAtr6.textContent="Facultad";
                lblAtr7.textContent="Año de Graduacion";
            }
            else if (selectTipo.value=="Futbolista")
            {
                lblAtr5.textContent="Equipo";
                lblAtr6.textContent="Posicion";
                lblAtr7.textContent="Cantidad de Goles";
            }
        }

        filtro.addEventListener("change", (event) =>
        {
            var elementosADibujar = event.target.value;
            dibujarTabla(elementosADibujar);
            if(filtro.value=="Futbolista")
            {
                chkEquipo.checked=true;
                chkPosicion.checked=true;
                chkCantidadGoles.checked=true

                chkEquipo.disabled=false;
                chkPosicion.disabled=false;
                chkCantidadGoles.disabled=false;

                chkTitulo.checked=false;
                chkFacultad.checked=false;
                chkAñoGraduacion.checked=false;

                chkTitulo.disabled=true;
                chkFacultad.disabled=true;
                chkAñoGraduacion.disabled=true;
            }
            else if (filtro.value=="Profecional")
            {
                chkTitulo.checked=true;
                chkFacultad.checked=true;
                chkAñoGraduacion.checked=true;

                chkTitulo.disabled=false;
                chkFacultad.disabled=false;
                chkAñoGraduacion.disabled=false;

                chkEquipo.checked=false;
                chkPosicion.checked=false;
                chkCantidadGoles.checked=false;

                chkEquipo.disabled=true;
                chkPosicion.disabled=true;
                chkCantidadGoles.disabled=true;

                
            }
            else
            {
                chkTitulo.checked=true;
                chkFacultad.checked=true;
                chkAñoGraduacion.checked=true;

                chkTitulo.disabled=true;
                chkFacultad.disabled=true;
                chkAñoGraduacion.disabled=true;

                chkEquipo.checked=false;
                chkPosicion.checked=false;
                chkCantidadGoles.checked=false;

                chkEquipo.disabled=false;
                chkPosicion.disabled=false;
                chkCantidadGoles.disabled=false;
            }
            actualizarColumnas();
        })   
        
        btnAgregar.addEventListener("click", (event)=>
        {
            alta();
            actualizarLabels();
        });

        selectTipo.addEventListener("change", (event)=>
        {
            actualizarLabels();
        });

        btnCancelar.addEventListener("click",(event)=>
        {
            alternarVista();
            blanquearFormulario();
            refrescarEventListener();
        });

        btnAceptar.addEventListener("click",(event)=>
        {
            var error = false;
            if(document.getElementById("CantidadGolesABM").innerText=="Baja")
            {
                levantarDatosFormulario();                
                var cuerpo;
                var objetoID = {
                    id: txtid
                };
                cuerpo = JSON.stringify(objetoID);   
                enviarDelete(cuerpo, "Profecional"); 
            }
            else if (document.getElementById("CantidadGolesABM").innerText=="Alta")
            {
                levantarDatosFormulario();
                var cuerpo;

                if (txtNombre!="" && txtApellido!=""  && txtEdad!="" && !isNaN(txtEdad) && txtEdad>15)
                {
                    if (selectTipo.value=="Profecional")
                    {
                        if (txtAtr5!="" && txtAtr6!="" && txtEdad!="" && !isNaN(txtAtr7) && txtAtr7>1950)
                        {
                            var nuevoProfecional = {
                                Nombre: txtNombre,
                                Apellido: txtApellido,
                                Edad: txtEdad,
                                Titulo: txtAtr5,
                                Facultad: txtAtr6,
                                AñoGraduacion: txtAtr7
                            };
                            cuerpo = JSON.stringify(nuevoProfecional);   
                            enviarPut(cuerpo, "Profecional");                            
                        }
                        else{
                            error=true;
                        }
                    }
                    else 
                    {
                        if (txtAtr5!="" && txtAtr6!="" && txtEdad!="" && !isNaN(txtAtr7) && txtAtr7>-1)
                        {
                            var nuevoFutbolista = {
                                Nombre: txtNombre,
                                Apellido: txtApellido,
                                Edad: txtEdad,
                                CantidadGoles: txtAtr5,
                                Titulo: txtAtr6,
                                CantidadGoles: txtAtr7
                            };
                            cuerpo = JSON.stringify(nuevoFutbolista);   
                            enviarPut(cuerpo, "Futbolista");                
                        }
                        else{
                            error=true;
                        }
                    }
                }
                else{
                    error=true;
                }
                if(error)
                {
                    alert("Error, revise los datos e intente nuevamente.");
                }
            }
            else if (document.getElementById("CantidadGolesABM").innerText=="Modificación")
            {
                levantarDatosFormulario();
                var cuerpo;

                if (txtNombre!="" && txtApellido!=""  && txtEdad!="" && !isNaN(txtEdad) && txtEdad>15)
                {
                    if (selectTipo.value=="Profecional")
                    {
                        if (txtAtr5!="" && txtAtr6!="" && txtEdad!="" && !isNaN(txtAtr7) && txtAtr7>1950)
                        {
                            var nuevoProfecional = {
                                Nombre: txtNombre,
                                Apellido: txtApellido,
                                Edad: txtEdad,
                                Titulo: txtAtr5,
                                Facultad: txtAtr6,
                                AñoGraduacion: txtAtr7
                            };
                            cuerpo = JSON.stringify(nuevoProfecional);   
                            enviarPut(cuerpo, "Profecional");                            
                        }
                        else{
                            error=true;
                        }
                    }
                    else 
                    {
                        if (txtAtr5!="" && txtAtr6!="" && txtEdad!="" && !isNaN(txtAtr7) && txtAtr7>-1)
                        {
                            var nuevoFutbolista = {
                                Nombre: txtNombre,
                                Apellido: txtApellido,
                                Edad: txtEdad,
                                CantidadGoles: txtAtr5,
                                Titulo: txtAtr6,
                                CantidadGoles: txtAtr7
                            };
                            cuerpo = JSON.stringify(nuevoFutbolista);   
                            enviarPut(cuerpo, "Futbolista");                
                        }
                        else{
                            error=true;
                        }
                    }            
                }
                else{
                    error=true;
                }
                if(error)
                {
                    alert("Error, revise los datos e intente nuevamente.");
                }
            }
        });

        function enviarPut(cuerpo,clase)
        {
            var xhr = new XMLHttpRequest();

            entraSpinner();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {                
                    saleSpinner();
                    if (xhr.status === 200)
                    {
                        var nuevopersona;
                        var responseData = JSON.parse(xhr.responseText);

                        if (clase === "Profecional") {
                            nuevopersona = new Profecional(responseData.id, txtNombre, txtApellido, txtEdad, txtAtr5, txtAtr6, txtAtr7);
                        } else {
                            nuevopersona = new Futbolista(responseData.id, txtNombre, txtApellido, txtEdad, txtAtr5, txtAtr6, txtAtr7);
                        }
                        personas.push(nuevopersona);
                        
                        blanquearFormulario();
                        alternarVista();
                        dibujarTabla();
                        saleSpinner();
                    }
                    else
                    {
                        console.log("Falló la request HTTP");
                        console.log(xhr.status);
                    }
                    
                }
            };
            xhr.open("PUT", "personaProfecionalFutbolista.php", true);
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.send(cuerpo);
        }

        async function enviarPost(cuerpo, clase)
        {
            entraSpinner();
            try 
            {
                var respuesta = await fetch("personaProfecionalFutbolista.php", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    }, 
                    body: cuerpo
                });
            } catch (error) {
                alert("No se pudo realizar la modificación: ",error);
            }
            if (respuesta.status==200)
            {
                modificarValidado();
            }
            else
            {
                alert("No se pudo realizar la modificación.");
            }
            console.log("Respuesta:", await respuesta.text(), "con código", respuesta.status);;
            saleSpinner();
        }

        async function enviarDelete(cuerpo)
        {
            entraSpinner();
            try 
            {
                var respuesta = await fetch("personaProfecionalFutbolista.php", {
                    method: "DELETE",
                    headers: {
                        "Content-Type": "application/json"
                    }, 
                    body: cuerpo
                });
            } catch (error) {
                alert("No se pudo realizar la eliminación: ",error);
            }
            if (respuesta.status==200)
            {
                personas = personas.filter((persona) => persona.id != txtid);
            }
            else
            {
                alert("No se pudo realizar la modificación.");
            }
            console.log("Respuesta:", await respuesta.text(), "con código", respuesta.status);;
            blanquearFormulario();
            alternarVista();
            dibujarTabla();
            saleSpinner();
        }

        function modificarValidado()
        {
            var error = false;
            var id = document.getElementById("txtid").value;
            var pos = -1;

            for(i=0;i<personas.length;i++)
            {
                if (personas[i].id==id)
                {
                    pos=i;
                    break;
                }
            }
            
            if (txtNombre!="" && txtApellido!=""  && txtEdad!="" && !isNaN(txtEdad) && txtEdad>15)
            {
                if (selectTipo.value=="Profecional")
                {
                    if (txtAtr5!="" && txtAtr6!="" && txtEdad!="" && !isNaN(txtEdad) && txtEdad>15 && !isNaN(txtAtr7) && txtAtr7>1950)
                    {
                        personas[pos].Nombre=document.getElementById("txtNombre").value;
                        personas[pos].Apellido=document.getElementById("txtApellido").value;
                        personas[pos].Edad=document.getElementById("txtEdad").value;
                        personas[pos].Equipo=document.getElementById("txtAtr5").value;
                        personas[pos].Posicion=document.getElementById("txtAtr6").value;
                        personas[pos].CantidadGoles=document.getElementById("txtAtr7").value;
                    }
                    else{
                        error=true;
                    }
                }
                else 
                {
                    if (txtAtr5!="" && txtAtr6!="" && txtEdad!="" && !isNaN(txtEdad) && txtEdad>15 && !isNaN(txtAtr7) && txtAtr7>-1)
                    {
                        personas[pos].Nombre=document.getElementById("txtNombre").value;
                        personas[pos].Apellido=document.getElementById("txtApellido").value;
                        personas[pos].Edad=document.getElementById("txtEdad").value;
                        personas[pos].Titulo=document.getElementById("txtAtr5").value;
                        personas[pos].Facultad=document.getElementById("txtAtr6").value;   
                        personas[pos].AñoGraduacion=document.getElementById("txtAtr7").value;          
                    }
                    else{
                        error=true;
                    }
                }
            }
            else
            {
                error = true;
            }
            if(error)
            {
                alert("Error, revise los datos e intente nuevamente.");
            }
            else
            {
                blanquearFormulario();
                alternarVista();
                dibujarTabla();
            }
        }

    </script>

</body>

</html>